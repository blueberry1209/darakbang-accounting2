<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>주님의교회 다락방 회계장부</title>
    <style>
        /* 모든 요소의 마진, 패딩 초기화 및 박스 모델 설정 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 바디 스타일: 폰트, 배경 그라데이션, 최소 높이 설정 */
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 50%, #f0efec 100%);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* 로그인 화면 컨테이너 스타일: 화면 중앙 정렬 */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #d4b5a0 0%, #c8a48a 25%, #a68b7a 50%, #8b7a6b 75%, #c8b5a4 100%);
        }

        /* 로그인 폼 스타일: 배경, 패딩, 그림자, 테두리, 중앙 정렬 */
        .login-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(139, 122, 107, 0.2);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(212, 181, 160, 0.3);
        }

        /* 로그인 폼 제목 스타일 */
        .login-form h1 {
            color: #8b7a6b;
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        /* 로그인 폼 설명 텍스트 스타일 */
        .login-form p {
            color: #a68b7a;
            margin-bottom: 30px;
        }

        /* 로그인 폼 입력 필드 스타일: 너비, 패딩, 테두리, 폰트, 마진, 배경, 전환 효과 */
        .login-form input {
            width: 100%;
            padding: 15px;
            border: 2px solid #d4b5a0;
            border-radius: 25px;
            font-size: 16px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        /* 로그인 폼 입력 필드 포커스 시 스타일 */
        .login-form input:focus {
            outline: none;
            border-color: #8b7a6b;
            background: white;
            transform: scale(1.02);
        }

        /* 로그인 폼 버튼 스타일: 너비, 패딩, 배경, 색상, 테두리, 폰트, 커서, 전환 효과 */
        .login-form button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #c8a48a 0%, #d4b5a0 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* 로그인 폼 버튼 호버 시 스타일 */
        .login-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(200, 164, 138, 0.4);
        }

        /* 메인 애플리케이션 초기 숨김 */
        .main-app {
            display: none;
        }

        /* 헤더 스타일: 배경 그라데이션, 색상, 패딩, 중앙 정렬, 그림자, 하단 테두리 */
        header {
            background: linear-gradient(135deg, #8b7a6b 0%, #a68b7a 50%, #7d8471 100%);
            color: white;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(139, 122, 107, 0.3);
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        /* 헤더 제목 스타일: 텍스트 그림자 */
        header h1 {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 5px;
        }

        /* 헤더 설명 텍스트 스타일: 투명도 */
        header p {
            opacity: 0.9;
        }

        /* 로그아웃 버튼 스타일: 위치, 배경, 색상, 테두리, 패딩, 폰트, 커서, 전환 효과 */
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        /* 로그아웃 버튼 호버 시 스타일 */
        .logout-btn:hover {
            background: white;
            color: #8b7a6b;
        }

        /* 네비게이션 바 스타일: 배경 그라데이션, 패딩, 중앙 정렬, 가로 스크롤, 그림자 */
        nav {
            background: linear-gradient(135deg, #b5c2a8 0%, #a8b59c 50%, #9ca892 100%);
            padding: 15px;
            text-align: center;
            overflow-x: auto;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* 네비게이션 버튼 스타일: 배경 그라데이션, 색상, 테두리, 패딩, 마진, 폰트, 커서, 전환 효과 */
        nav button {
            background: linear-gradient(135deg, #d4d8ce 0%, #c8ccc2 100%);
            color: #5a5a5a;
            border: none; /* Yellow border removed */
            padding: 12px 20px;
            margin: 0 5px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            min-height: 44px;
            display: inline-block;
            font-weight: 500;
        }

        /* 네비게이션 버튼 호버 시 스타일 */
        nav button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 216, 206, 0.4);
        }

        /* 활성화된 네비게이션 버튼 스타일 */
        nav button.active {
            background: linear-gradient(135deg, #8b7a6b 0%, #a68b7a 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(139, 122, 107, 0.3);
        }

        /* 컨테이너 스타일: 최대 너비, 중앙 정렬, 패딩 */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        /* 섹션 스타일: 배경, 마진, 패딩, 테두리, 그림자, 초기 숨김 */
        .section {
            background: rgba(255, 255, 255, 0.95);
            margin: 20px 0;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(139, 122, 107, 0.1);
            display: none;
            border: 2px solid rgba(212, 181, 160, 0.2);
            backdrop-filter: blur(10px);
        }

        /* 활성화된 섹션 표시 */
        .section.active {
            display: block;
        }

        /* 초기 설정 섹션 고유 스타일 */
        .setup-section {
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 100%);
            border: 3px solid #d4b5a0;
        }

        /* 잔액 요약 카드 컨테이너 스타일: 그리드 레이아웃 */
        .balance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* 잔액 카드 스타일: 배경 그라데이션, 색상, 패딩, 테두리, 그림자 */
        .balance-card {
            background: linear-gradient(135deg, #9ca892 0%, #a8b59c 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(156, 168, 146, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* 잔액 카드 제목 스타일 */
        .balance-card h3 {
            margin-bottom: 10px;
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* 잔액 카드 금액 스타일 */
        .balance-card .amount {
            font-size: 1.8em;
            font-weight: bold;
            color: white;
        }

        /* 폼 그룹 스타일: 마진 */
        .form-group {
            margin-bottom: 20px;
        }

        /* 폼 그룹 라벨 스타일: 블록 요소, 마진, 폰트 굵기, 색상 */
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #8b7a6b;
        }

        /* 폼 그룹 입력, 선택, 텍스트 영역 필드 스타일 */
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #d4b5a0;
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        /* 폼 그룹 입력, 선택, 텍스트 영역 필드 포커스 시 스타일 */
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #8b7a6b;
            background: white;
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(139, 122, 107, 0.2);
        }

        /* 일반 버튼 스타일 */
        .btn {
            background: linear-gradient(135deg, #a8b59c 0%, #9ca892 100%);
            color: white;
            border: none; /* Yellow border removed */
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-height: 44px;
            width: 100%;
        }

        /* 일반 버튼 호버 시 스타일 */
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 181, 156, 0.4);
        }

        /* 성공 버튼 스타일 */
        .btn-success {
            background: linear-gradient(135deg, #7d8471 0%, #6b7560 100%);
            color: white;
        }

        /* 성공 버튼 호버 시 스타일 */
        .btn-success:hover {
            box-shadow: 0 5px 15px rgba(125, 132, 113, 0.4);
        }

        /* 위험 버튼 스타일 */
        .btn-danger {
            background: linear-gradient(135deg, #c8a48a 0%, #b5936d 100%);
            color: white;
        }

        /* 위험 버튼 호버 시 스타일 */
        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(200, 164, 138, 0.4);
        }

        /* 경고 버튼 스타일 */
        .btn-warning {
            background: linear-gradient(135deg, #d4b5a0 0%, #c8a48a 100%);
            color: white;
        }

        /* 경고 버튼 호버 시 스타일 */
        .btn-warning:hover {
            box-shadow: 0 5px 15px rgba(212, 181, 160, 0.4);
        }

        /* 정보 버튼 스타일 */
        .btn-info {
            background: linear-gradient(135deg, #9ca892 0%, #8b9480 100%);
            color: white;
        }

        /* 정보 버튼 호버 시 스타일 */
        .btn-info:hover {
            box-shadow: 0 5px 15px rgba(156, 168, 146, 0.4);
        }

        /* 거래 테이블 스타일 */
        .transaction-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow-x: auto;
            display: block;
            white-space: nowrap;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
        }

        /* 거래 테이블 헤더 및 바디 스타일 */
        .transaction-table thead, .transaction-table tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        /* 거래 테이블 헤더 및 셀 스타일 */
        .transaction-table th, .transaction-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #d4b5a0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 거래 테이블 헤더 스타일 */
        .transaction-table th {
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 100%);
            font-weight: bold;
            position: sticky;
            top: 0;
            color: #8b7a6b;
        }

        /* 수입 금액 색상 */
        .income {
            color: #7d8471;
            font-weight: bold;
        }

        /* 지출 금액 색상 */
        .expense {
            color: #c8a48a;
            font-weight: bold;
        }

        /* 보고서 섹션 스타일 */
        .report-section {
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 100%);
            border-radius: 15px;
            border: 2px solid rgba(212, 181, 160, 0.3);
        }

        /* 회계 보고서 탭 전용 폰트 크기 조정 */
        #report {
            font-size: 14px; /* 기본 폰트 크기를 14px로 줄임 */
        }

        #report h2 {
            font-size: 20px; /* 메인 제목 크기 조정 */
        }

        #report h3 {
            font-size: 16px; /* 서브 제목 크기 조정 */
        }

        #report p {
            font-size: 13px; /* 본문 텍스트 크기 조정 */
            line-height: 1.4; /* 줄 간격 조정 */
        }

        #report .btn {
            font-size: 14px; /* 버튼 폰트 크기 조정 */
            padding: 12px 20px; /* 버튼 패딩 조정 */
        }

        /* 두 컬럼 레이아웃 스타일 */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        /* 알림 메시지 스타일 */
        .alert {
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            border-left: 4px solid;
        }

        /* 경고 알림 스타일 */
        .alert-warning {
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 100%);
            border-color: #d4b5a0;
            color: #8b7a6b;
        }

        /* 정보 알림 스타일 */
        .alert-info {
            background: linear-gradient(135deg, #d4d8ce 0%, #c8ccc2 100%);
            border-color: #9ca892;
            color: #5a5a5a;
        }

        /* 설정 폼 스타일 */
        .settings-form {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #d4b5a0;
            margin-bottom: 20px;
        }

        /* 보고서 요약 테이블 스타일 */
        .report-summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            overflow: hidden; /* For rounded corners on table */
            font-size: 12px; /* 테이블 폰트 크기 줄임 */
        }

        .report-summary-table th, .report-summary-table td {
            padding: 8px 12px; /* 패딩 줄임 */
            text-align: left;
            border-bottom: 1px solid #e0d9d4;
        }

        .report-summary-table th {
            background-color: #f0efec;
            font-weight: bold;
            color: #8b7a6b;
            font-size: 11px; /* 헤더 폰트 더 작게 */
        }

        .report-summary-table tr:last-child td {
            border-bottom: none;
        }

        .report-summary-table .total-row td {
            font-weight: bold;
            background-color: #e8e4e0;
        }
        .report-summary-table .total-row .amount {
            color: #8b7a6b; /* Adjust color for total amounts */
        }
        .report-summary-table .income-amount {
            color: #7d8471;
        }
        .report-summary-table .expense-amount {
            color: #c8a48a;
        }
        .report-summary-table .balance-amount {
            color: #5a5a5a;
        }

        /* 미디어 쿼리: 768px 이하 화면 (모바일) */
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr; /* 두 컬럼을 한 컬럼으로 변경 */
            }

            .balance-summary {
                grid-template-columns: 1fr; /* 잔액 요약 카드도 한 컬럼으로 변경 */
            }

            .logout-btn {
                position: relative; /* 로그아웃 버튼 위치 조정 */
                top: auto;
                right: auto;
                margin-top: 10px;
                width: 100%;
            }

            nav {
                padding: 10px; /* 네비게이션 패딩 조정 */
            }

            nav button {
                padding: 12px 15px; /* 네비게이션 버튼 패딩 조정 */
                margin: 2px;
                font-size: 13px;
            }

            /* 모바일에서 회계 보고서 폰트 더 작게 */
            #report {
                font-size: 12px;
            }

            #report h2 {
                font-size: 18px;
            }

            #report h3 {
                font-size: 14px;
            }

            #report p {
                font-size: 11px;
            }
        }

        /* 회계 보고서 섹션 텍스트 굵기 조정 */
        .report-section h3,
        .report-section p strong {
            font-weight: normal; /* 기본 글자 굵기로 설정 */
        }
        .report-section p {
            font-weight: normal; /* 모든 p 태그의 폰트 굵기를 기본으로 */
        }
        .report-section strong {
            font-weight: 600; /* 필요한 경우 strong 태그는 약간 굵게 유지 */
        }
        .report-section .amount {
            font-weight: bold; /* 금액은 여전히 굵게 유지 */
        }

        /* 인쇄 시 스타일 */
        @media print {
            body * {
                visibility: hidden; /* 모든 요소 숨기기 */
            }
            /* 보고서 섹션 전체를 보이도록 설정 */
            #report {
                visibility: visible;
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 10px; /* 패딩 줄임 */
                box-shadow: none;
                border: none;
                background: none;
                backdrop-filter: none;
                font-size: 11px; /* 인쇄 시 폰트 더 작게 */
            }
            /* 보고서 섹션 내의 모든 자식 요소도 보이도록 설정 */
            #report * {
                visibility: visible;
            }

            /* '회계 기간 설정' 섹션 숨기기 */
            #report .report-section.print-hidden {
                display: none;
            }

            /* 보고서 섹션 내의 특정 요소들에 대한 인쇄 스타일 */
            #report .report-section {
                box-shadow: none;
                border: none;
                background: none;
                padding: 0;
                margin: 8px 0; /* 마진 줄임 */
            }

            #report h2 {
                font-size: 16px; /* 인쇄 시 제목 크기 */
                margin-bottom: 10px;
            }

            #report h3 {
                font-size: 13px; /* 인쇄 시 서브 제목 크기 */
                margin-bottom: 8px;
            }

            #report p {
                font-size: 10px; /* 인쇄 시 본문 크기 */
                line-height: 1.3;
                margin: 2px 0;
            }

            #report .report-summary-table {
                box-shadow: none;
                border-radius: 0;
                background: none;
                border: 1px solid #ccc; /* 인쇄 시 테이블 테두리 추가 */
                font-size: 10px; /* 인쇄 시 테이블 폰트 더 작게 */
                margin-top: 8px;
            }
            #report .report-summary-table th, #report .report-summary-table td {
                border: 1px solid #ccc; /* 인쇄 시 셀 테두리 추가 */
                padding: 4px 8px; /* 인쇄 시 패딩 더 줄임 */
                font-size: 9px; /* 인쇄 시 셀 폰트 더 작게 */
            }
            #report .report-summary-table .total-row td {
                background-color: #f0f0f0; /* 인쇄 시 배경색 조정 */
                font-weight: bold;
            }
            /* 인쇄 시 버튼 숨기기 */
            #report .btn {
                display: none;
            }
            /* 보고서 정보 (다락방 이름, 기간 등)도 인쇄 시 보이도록 */
            #report .report-section p {
                visibility: visible;
                color: #000; /* 인쇄 시 텍스트 색상 검정으로 */
            }
            #report .report-section strong {
                visibility: visible;
                color: #000;
            }

            /* 인쇄 시 페이지 나누기 방지 */
            #report .report-summary-table {
                page-break-inside: avoid;
            }
            
            /* 인쇄 시 여백 최소화 */
            @page {
                margin: 0.5in;
                size: A4;
            }
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <div class="login-form">
            <h1>🏛️ 주님의교회 다락방 회계장부</h1>
            <p>회계 관리를 위해 비밀번호를 입력해주세요</p>
            <input type="password" id="passwordInput" placeholder="비밀번호를 입력하세요" onkeypress="checkEnterKey(event)">
            <button onclick="login()">로그인</button>
            <p style="font-size: 12px; color: #999; margin-top: 20px;">
                기본 비밀번호: 1234 (설정에서 변경 가능)
            </p>
        </div>
    </div>

    <div id="mainApp" class="main-app">
        <header>
            <button class="logout-btn" onclick="logout()">로그아웃</button>
            <h1>🏛️ <span id="headerDarakbangName">주님의교회 다락방</span> 회계장부</h1>
            <p>투명하고 체계적인 회계 관리</p>
        </header>

        <nav>
            <button onclick="showSection('setup')" class="active">초기설정</button>
            <button onclick="showSection('dashboard')">대시보드</button>
            <button onclick="showSection('transaction')">입출금등록</button>
            <button onclick="showSection('history')">거래내역</button>
            <button onclick="showSection('report')">회계보고서</button>
        </nav>

        <div class="container">
            <div id="setup" class="section active setup-section">
                <h2>⚙️ 초기 설정</h2>
                <div class="alert alert-warning">
                    <strong>중요!</strong> 회계 시작 전에 기준 날짜와 이월 잔고를 설정해주세요.
                </div>

                <div id="setupForm" class="settings-form">
                    <div class="form-group">
                        <label>다락방 이름</label>
                        <input type="text" id="setupDarakbangName" placeholder="다락방 이름을 입력하세요">
                    </div>
                    <div class="form-group">
                        <label>회계 기준 날짜</label>
                        <input type="date" id="baseDate" value="">
                    </div>

                    <div class="form-group">
                        <label>이월 잔고 (원)</label>
                        <input type="number" id="carryOverInput" placeholder="예: 50000" value="50000">
                    </div>

                    <div class="form-group">
                        <label>담당자 이름</label>
                        <input type="text" id="managerName" placeholder="회계 담당자 이름을 입력하세요">
                    </div>

                    <div class="form-group">
                        <label>비밀번호 변경 (선택사항)</label>
                        <input type="password" id="newPassword" placeholder="새 비밀번호 (기본값: 1234)">
                    </div>

                    <button onclick="saveInitialSettings()" class="btn btn-success">설정 저장</button>
                </div>

                <div id="currentSettings" style="margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.8); border-radius: 15px; display: none;">
                    <h3>현재 설정</h3>
                    <p><strong>다락방 이름:</strong> <span id="currentDarakbangName">-</span></p>
                    <p><strong>기준 날짜:</strong> <span id="currentBaseDate">-</span></p>
                    <p><strong>이월 잔고:</strong> <span id="currentCarryOver">-</span></p>
                    <p><strong>담당자:</strong> <span id="currentManager">-</span></p>

                    <div class="alert alert-warning" style="margin-top: 20px;">
                        <strong>⚠️ 주의!</strong> 설정을 초기화하면 모든 거래 내역이 삭제됩니다.
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="editSettings()" class="btn btn-warning" style="flex: 1;">설정 수정</button>
                        <button onclick="resetAllData()" class="btn btn-danger" style="flex: 1;">전체 초기화</button>
                    </div>
                </div>
            </div>

            <div id="dashboard" class="section">
                <h2>📊 회계 현황 대시보드</h2>
                <div class="balance-summary">
                    <div class="balance-card">
                        <h3>이월 잔고</h3>
                        <div class="amount" id="carryOverBalance">0원</div>
                    </div>
                    <div class="balance-card">
                        <h3>총 입금</h3>
                        <div class="amount" id="totalIncome">0원</div>
                    </div>
                    <div class="balance-card">
                        <h3>총 출금</h3>
                        <div class="amount" id="totalExpense">0원</div>
                    </div>
                    <div class="balance-card">
                        <h3>현재 잔액</h3>
                        <div class="amount" id="currentBalance">0원</div>
                    </div>
                </div>

                <div class="two-column">
                    <div class="report-section">
                        <h3>📈 이번 달 요약</h3>
                        <p><strong>다락방 이름:</strong> <span id="dashboardDarakbangName">-</span></p>
                        <p><strong>거래 건수:</strong> <span id="transactionCount">0건</span></p>
                        <p><strong>최근 거래일:</strong> <span id="lastTransactionDate">-</span></p>
                    </div>

                    <div class="report-section">
                        <h3>⏰ 빠른 작업</h3>
                        <button onclick="showSection('transaction')" class="btn" style="margin-bottom: 10px;">💰 입출금 등록</button>
                        <button onclick="showSection('history')" class="btn btn-warning" style="margin-bottom: 10px;">📋 거래 내역</button>
                        <button onclick="showSection('report')" class="btn btn-info">📊 회계 보고서</button>
                     </div>
                </div>
            </div>

            <div id="transaction" class="section">
                <h2>💰 입출금 등록</h2>

                <div class="two-column">
                    <div>
                        <h3>✅ 입금 등록</h3>
                        <div class="form-group">
                            <label>입금액</label>
                            <input type="number" id="incomeAmount" placeholder="금액을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>입금 내역</label>
                            <select id="incomeCategory">
                                <option value="다락방 헌금">다락방 헌금</option>
                                <option value="모임비">모임비</option>
                                <option value="후원금">후원금</option>
                                <option value="이자수입">이자수입</option>
                                <option value="기타수입">기타수입</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>상세 내용</label>
                            <input type="text" id="incomeDescription" placeholder="상세 내용을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>입금자 이름</label>
                            <input type="text" id="incomePersonName" placeholder="입금자 이름">
                        </div>
                        <button onclick="addTransaction('income')" class="btn btn-success">입금 등록</button>
                    </div>

                    <div>
                        <h3>❌ 출금 등록</h3>
                        <div class="form-group">
                            <label>출금액</label>
                            <input type="number" id="expenseAmount" placeholder="금액을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>출금 내역</label>
                            <select id="expenseCategory">
                                <option value="다락방 헌금">다락방 헌금</option>
                                <option value="식사비">식사비</option>
                                <option value="열린 다락방 모임비">열린 다락방 모임비</option>
                                <option value="선물비">선물비</option>
                                <option value="행사비">행사비</option>
                                <option value="기타지출">기타지출</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>상세 내용</label>
                            <input type="text" id="expenseDescription" placeholder="상세 내용을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>지출자 이름</label>
                            <input type="text" id="expensePersonName" placeholder="지출자 이름">
                        </div>
                        <button onclick="addTransaction('expense')" class="btn btn-danger">출금 등록</button>
                    </div>
                </div>
            </div>

            <div id="history" class="section">
                <h2>📋 거래 내역</h2>
                <div style="overflow-x: auto;">
                    <table class="transaction-table">
                        <thead>
                            <tr>
                                <th>날짜</th> <th>구분</th>
                                <th>카테고리</th>
                                <th>내용</th>
                                <th>담당자</th>
                                <th>금액</th>
                                <th>잔액</th>
                                <th>삭제</th>
                            </tr>
                        </thead>
                        <tbody id="transactionHistory">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="report" class="section">
                <h2>📊 회계 결산 보고서</h2>

                <div class="report-section print-hidden"> <!-- 이 부분을 인쇄 시 숨김 -->
                    <h3>📅 회계 기간 설정</h3>
                    <div class="two-column">
                        <div class="form-group">
                            <label>시작 날짜</label>
                            <input type="date" id="reportStartDate" value="" placeholder="시작 날짜 선택">
                        </div>
                        <div class="form-group">
                            <label>종료 날짜</label>
                            <input type="date" id="reportEndDate" value="" placeholder="종료 날짜 선택">
                        </div>
                    </div>

                    <div style="text-align: center; margin: 20px 0;">
                        <button onclick="generateReport()" class="btn btn-success" style="padding: 15px 30px; font-size: 18px;">📄 선택 기간 확인</button>
                    </div>
                </div>

                <div class="report-section">
                    <div style="background: rgba(255, 255, 255, 0.8); padding: 15px; border-radius: 10px; text-align: center;">
                        <p><strong>다락방 이름:</strong> <span id="reportDarakbangName">-</span></p>
                        <p><strong>보고서 기간:</strong> <span id="reportPeriod">전체 기간</span></p>
                        <p><strong>담당자:</strong> <span id="reportManager">-</span> | <strong>작성일:</strong> <span id="reportDate">-</span></p>
                    </div>
                </div>

                <div class="report-section">
                    <h3>📋 결산 요약</h3>
                    <table class="report-summary-table" id="consolidatedReport">
                        <thead>
                            <tr>
                                <th>항목</th>
                                <th>금액</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Consolidated report rows will be inserted here by JS -->
                        </tbody>
                    </table>
                </div>

                <div style="text-align: center; margin-top: 30px;" class="print-hidden"> <!-- 이 버튼도 인쇄 시 숨김 -->
                    <button onclick="printReport()" class="btn btn-info">🖨️ 보고서 인쇄</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수 초기화
        let transactions = []; // 거래 내역을 저장하는 배열
        let currentPassword = '1234'; // 현재 비밀번호 (기본값 1234)
        let settings = { // 애플리케이션 설정을 저장하는 객체
            darakbangName: '', // 다락방 이름 추가
            baseDate: '', // 회계 기준 날짜
            carryOverBalance: 0, // 이월 잔고
            managerName: '', // 담당자 이름
            isSetup: false // 초기 설정 완료 여부
        };

        // 데이터를 로컬 스토리지에 저장하는 함수
        function saveData() {
            try {
                const data = {
                    transactions: transactions,
                    settings: settings,
                    currentPassword: currentPassword,
                    lastSaved: new Date().toISOString() // 마지막 저장 시간
                };
                localStorage.setItem('darakbang-accounting-data', JSON.stringify(data));
            } catch (error) {
                console.error('데이터 저장 중 오류:', error); // 오류 발생 시 콘솔에 출력
            }
        }

        // 로컬 스토리지에서 데이터를 불러오는 함수
        function loadData() {
            try {
                const savedData = localStorage.getItem('darakbang-accounting-data');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    transactions = data.transactions || []; // 거래 내역 불러오기 (없으면 빈 배열)
                    settings = data.settings || { // 설정 불러오기 (없으면 기본값)
                        darakbangName: '',
                        baseDate: '',
                        carryOverBalance: 0,
                        managerName: '',
                        isSetup: false
                    };
                    currentPassword = data.currentPassword || '1234'; // 비밀번호 불러오기 (없으면 1234)
                    return true; // 데이터 불러오기 성공
                }
            } catch (error) {
                console.error('데이터 불러오기 중 오류:', error); // 오류 발생 시 콘솔에 출력
            }
            return false; // 데이터 불러오기 실패
        }

        // 엔터 키 입력 시 로그인 함수 호출
        function checkEnterKey(event) {
            if (event.key === 'Enter') {
                login();
            }
        }

        // 로그인 처리 함수
        function login() {
            const password = document.getElementById('passwordInput').value; // 비밀번호 입력값 가져오기

            // 비밀번호가 일치하는지 확인
            if (password === currentPassword) {
                // 로그인 성공 시 화면 전환 및 데이터 업데이트
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                loadSettings(); // 설정 로드
                setTodayAsDefault(); // 오늘 날짜 기본값 설정
                updateAllDisplays(); // 모든 화면 업데이트
                updateHeaderDarakbangName(); // 헤더 다락방 이름 업데이트
                generateReport(); // 로그인 시 보고서 초기화
            } else {
                // 커스텀 알림 메시지 표시
                showCustomAlert('비밀번호가 올바르지 않습니다.');
                document.getElementById('passwordInput').value = ''; // 비밀번호 입력 필드 초기화
            }
        }

        // 로그아웃 처리 함수
        function logout() {
            showCustomConfirm('로그아웃 하시겠습니까?', () => { // 로그아웃 확인 대화상자
                document.getElementById('loginScreen').style.display = 'flex'; // 로그인 화면 표시
                document.getElementById('mainApp').style.display = 'none'; // 메인 앱 숨김
                document.getElementById('passwordInput').value = ''; // 비밀번호 입력 필드 초기화
            });
        }

        // 페이지 로드 시 초기 설정 확인 및 화면 표시
        window.onload = function() {
            loadData(); // 저장된 데이터 불러오기

            document.getElementById('loginScreen').style.display = 'flex'; // 로그인 화면 기본 표시
            document.getElementById('mainApp').style.display = 'none'; // 메인 앱 기본 숨김
        };

        // 오늘 날짜를 날짜 입력 필드의 기본값으로 설정
        function setTodayAsDefault() {
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD 형식으로 변환
            document.getElementById('baseDate').value = today;
        }

        // 헤더의 다락방 이름을 업데이트하는 함수
        function updateHeaderDarakbangName() {
            const headerDarakbangName = document.getElementById('headerDarakbangName');
            if (settings.darakbangName) {
                headerDarakbangName.textContent = `${settings.darakbangName} 다락방`;
            } else {
                headerDarakbangName.textContent = '주님의교회 다락방';
            }
        }

        // 초기 설정 저장 함수
        function saveInitialSettings() {
            const darakbangName = document.getElementById('setupDarakbangName').value.trim(); // 다락방 이름 입력값
            const baseDate = document.getElementById('baseDate').value; // 기준 날짜 입력값
            const carryOver = parseInt(document.getElementById('carryOverInput').value) || 0; // 이월 잔고 입력값
            const manager = document.getElementById('managerName').value.trim(); // 담당자 이름 입력값
            const newPassword = document.getElementById('newPassword').value.trim(); // 새 비밀번호 입력값

            // 필수 필드 유효성 검사
            if (!darakbangName) {
                showCustomAlert('다락방 이름을 입력해주세요.');
                return;
            }
            if (!baseDate) {
                showCustomAlert('기준 날짜를 선택해주세요.');
                return;
            }
            if (!manager) {
                showCustomAlert('담당자 이름을 입력해주세요.');
                return;
            }

            // 설정 객체 업데이트
            settings = {
                darakbangName: darakbangName, // 설정에 다락방 이름 추가
                baseDate: baseDate,
                carryOverBalance: carryOver,
                managerName: manager,
                isSetup: true
            };

            // 새 비밀번호가 입력되었으면 변경
            if (newPassword) {
                currentPassword = newPassword;
                showCustomAlert('비밀번호가 변경되었습니다.');
            }

            updateSettingsDisplay(); // 설정 표시 업데이트
            updateAllDisplays(); // 모든 화면 업데이트
            updateHeaderDarakbangName(); // 헤더 다락방 이름 업데이트
            generateReport(); // 설정 저장 시 보고서 업데이트

            // 설정 폼 숨기고 현재 설정 표시
            document.getElementById('setupForm').style.display = 'none';
            document.getElementById('currentSettings').style.display = 'block';

            saveData(); // 데이터 저장

            showCustomAlert('초기 설정이 저장되었습니다!');

            document.getElementById('newPassword').value = ''; // 비밀번호 입력 필드 초기화
        }

        // 설정 수정 함수
        function editSettings() {
            showCustomConfirm('설정을 수정하시겠습니까?\n\n기존 설정값이 입력 폼에 다시 표시됩니다.', () => {
                // 현재 설정값을 입력 폼에 다시 표시
                document.getElementById('setupDarakbangName').value = settings.darakbangName; // 다락방 이름
                document.getElementById('baseDate').value = settings.baseDate;
                document.getElementById('carryOverInput').value = settings.carryOverBalance;
                document.getElementById('managerName').value = settings.managerName;

                // 폼 다시 표시
                document.getElementById('setupForm').style.display = 'block';
                document.getElementById('currentSettings').style.display = 'none';
            });
        }

        // 모든 데이터 초기화 함수
        function resetAllData() {
            const confirmText = `정말로 모든 데이터를 초기화하시겠습니까?

삭제될 데이터:
• 초기 설정 (다락방 이름, 기준날짜, 이월잔고, 담당자)
• 모든 거래 내역 (${transactions.length}건)
• 비밀번호는 기본값(1234)으로 초기화

⚠️ 이 작업은 되돌릴 수 없습니다!`;

            showCustomConfirm(confirmText, () => {
                const finalConfirm = prompt('정말로 초기화하려면 "초기화"라고 입력하세요:', '');

                if (finalConfirm === '초기화') {
                    // 모든 데이터 초기화
                    transactions = [];
                    currentPassword = '1234';
                    settings = {
                        darakbangName: '', // 다락방 이름 초기화
                        baseDate: '',
                        carryOverBalance: 0,
                        managerName: '',
                        isSetup: false
                    };

                    // 폼 입력 필드 초기화
                    document.getElementById('setupDarakbangName').value = ''; // 다락방 이름 입력 필드 초기화
                    document.getElementById('baseDate').value = '';
                    document.getElementById('carryOverInput').value = '50000';
                    document.getElementById('managerName').value = '';
                    document.getElementById('newPassword').value = '';

                    // 화면 상태 초기화
                    document.getElementById('setupForm').style.display = 'block';
                    document.getElementById('currentSettings').style.display = 'none';

                    setTodayAsDefault(); // 오늘 날짜 다시 설정
                    updateAllDisplays(); // 모든 화면 업데이트
                    updateHeaderDarakbangName(); // 헤더 다락방 이름 초기화
                    generateReport(); // 데이터 초기화 시 보고서도 초기화

                    saveData(); // 초기화된 상태 저장

                    showCustomAlert('모든 데이터가 초기화되었습니다.\n비밀번호도 기본값(1234)으로 초기화되었습니다.');
                } else {
                    showCustomAlert('취소되었습니다.');
                }
            });
        }

        // 현재 설정 정보를 화면에 표시하는 함수
        function updateSettingsDisplay() {
            if (settings.isSetup) {
                document.getElementById('setupForm').style.display = 'none';
                document.getElementById('currentSettings').style.display = 'block';
                document.getElementById('currentDarakbangName').textContent = settings.darakbangName; // 다락방 이름 표시
                document.getElementById('currentBaseDate').textContent = settings.baseDate;
                document.getElementById('currentCarryOver').textContent = settings.carryOverBalance.toLocaleString() + '원';
                document.getElementById('currentManager').textContent = settings.managerName;
            } else {
                document.getElementById('setupForm').style.display = 'block';
                document.getElementById('currentSettings').style.display = 'none';
            }
        }

        // 설정 정보를 로드하여 화면에 반영하는 함수
        function loadSettings() {
            updateSettingsDisplay();
        }

        // 섹션 전환 함수
        function showSection(sectionName) {
            // 초기 설정이 완료되지 않았으면 'setup' 섹션 외에는 접근 불가
            if (!settings.isSetup && sectionName !== 'setup') {
                showCustomAlert('먼저 초기 설정을 완료해주세요.');
                return;
            }

            // 모든 섹션 비활성화
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));

            // 모든 네비게이션 버튼 비활성화
            const buttons = document.querySelectorAll('nav button');
            buttons.forEach(button => button.classList.remove('active'));

            // 선택된 섹션 및 버튼 활성화
            document.getElementById(sectionName).classList.add('active');
            // 이벤트 타겟이 없을 경우 (예: 초기 로드 시)를 대비하여 예외 처리
            const clickedButton = Array.from(buttons).find(btn => btn.onclick.toString().includes(`showSection('${sectionName}')`));
            if (clickedButton) {
                clickedButton.classList.add('active');
            }

            // 회계보고서 탭으로 이동 시 보고서 재생성
            if (sectionName === 'report') {
                generateReport();
            }
        }

        // 입출금 거래 등록 함수
        function addTransaction(type) {
            // 초기 설정이 완료되지 않았으면 경고
            if (!settings.isSetup) {
                showCustomAlert('먼저 초기 설정을 완료해주세요.');
                return;
            }

            let amount, category, description, personName;

            if (type === 'income') { // 입금 처리
                amount = parseInt(document.getElementById('incomeAmount').value);
                category = document.getElementById('incomeCategory').value;
                description = document.getElementById('incomeDescription').value;
                personName = document.getElementById('incomePersonName').value.trim();

                if (!amount || amount <= 0) {
                    showCustomAlert('올바른 입금액을 입력해주세요.');
                    return;
                }

                // 입력 필드 초기화
                document.getElementById('incomeAmount').value = '';
                document.getElementById('incomeDescription').value = '';
                document.getElementById('incomePersonName').value = '';

            } else { // 출금 처리
                amount = parseInt(document.getElementById('expenseAmount').value);
                category = document.getElementById('expenseCategory').value;
                description = document.getElementById('expenseDescription').value;
                personName = document.getElementById('expensePersonName').value.trim();

                if (!amount || amount <= 0) {
                    showCustomAlert('올바른 출금액을 입력해주세요.');
                    return;
                }

                // 입력 필드 초기화
                document.getElementById('expenseAmount').value = '';
                document.getElementById('expenseDescription').value = '';
                document.getElementById('expensePersonName').value = '';
            }

            // 현재 잔액 계산 및 새로운 잔액 적용
            const currentBalance = getCurrentBalance();
            const newBalance = type === 'income' ? currentBalance + amount : currentBalance - amount;

            // 새로운 거래 객체 생성
            const transaction = {
                id: Date.now(), // 고유 ID (타임스탬프 사용)
                // 날짜와 시간을 함께 저장
                dateTime: new Date().toLocaleString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }),
                date: new Date().toISOString().split('T')[0], // Store only date for history display
                type: type, // 'income' 또는 'expense'
                category: category, // 카테고리
                description: description, // 상세 내용
                amount: amount, // 금액
                balance: newBalance, // 거래 후 잔액
                personName: personName || '미입력' // 담당자 이름 (없으면 '미입력')
            };

            transactions.push(transaction); // 거래 내역에 추가
            updateAllDisplays(); // 모든 화면 업데이트
            generateReport(); // 거래 등록 시 보고서 업데이트

            saveData(); // 데이터 저장

            showCustomAlert(type === 'income' ? '입금이 등록되었습니다!' : '출금이 등록되었습니다!');
        }

       // 거래 삭제 함수
        function deleteTransaction(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId); // 삭제할 거래 찾기
            if (transaction) {
                // 삭제 확인 대화상자
                showCustomConfirm(`${transaction.dateTime} ${transaction.category} 거래(${transaction.amount.toLocaleString()}원)를 삭제하시겠습니까?\n\n⚠️ 주의: 이후 거래들의 잔액이 모두 재계산됩니다.`, () => {
                    // 거래 삭제
                    const index = transactions.findIndex(t => t.id === transactionId);
                    transactions.splice(index, 1); // 배열에서 해당 거래 제거

                    recalculateBalances(); // 삭제 후 잔액 재계산
                    updateAllDisplays(); // 모든 화면 업데이트
                    generateReport(); // 거래 삭제 시 보고서 업데이트

                    saveData(); // 데이터 저장

                    showCustomAlert('거래가 삭제되었습니다.');
                });
            }
        }

        // 모든 거래의 잔액을 재계산하는 함수 (거래 삭제 후 호출)
        function recalculateBalances() {
            let currentBalance = settings.carryOverBalance; // 이월 잔고부터 시작

            // 날짜와 시간 기준으로 정렬하여 순차적으로 잔액 계산
            transactions.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));

            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    currentBalance += transaction.amount;
                } else {
                    currentBalance -= transaction.amount;
                }
                transaction.balance = currentBalance; // 거래 후 잔액 업데이트
            });
        }

        // 현재 총 잔액을 계산하여 반환하는 함수
        function getCurrentBalance() {
            let balance = settings.carryOverBalance; // 이월 잔고부터 시작
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    balance += transaction.amount;
                } else {
                    balance -= transaction.amount;
                }
            });
            return balance;
        }

        // 대시보드 및 거래 내역 테이블을 포함한 모든 화면을 업데이트하는 함수
        function updateAllDisplays() {
            updateDashboard();
            updateTransactionHistory();
        }

        // 대시보드 정보를 업데이트하는 함수
        function updateDashboard() {
            // 총 수입, 총 지출, 현재 잔액 계산
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const currentBalance = getCurrentBalance();

            // 각 요소에 계산된 값 표시
            document.getElementById('carryOverBalance').textContent = settings.carryOverBalance.toLocaleString() + '원'; // 이월 잔고는 설정값 그대로
            document.getElementById('totalIncome').textContent = totalIncome.toLocaleString() + '원';
            document.getElementById('totalExpense').textContent = totalExpense.toLocaleString() + '원';
            document.getElementById('currentBalance').textContent = currentBalance.toLocaleString() + '원';
            document.getElementById('transactionCount').textContent = transactions.length + '건';

            // 최근 거래일 표시 (이제 날짜와 시간 모두 표시)
            if (transactions.length > 0) {
                // Use the 'date' property for display
                document.getElementById('lastTransactionDate').textContent = new Date(transactions[transactions.length - 1].date).toLocaleDateString('ko-KR');
            } else {
                document.getElementById('lastTransactionDate').textContent = '-';
            }

            // 대시보드에 다락방 이름 표시
            document.getElementById('dashboardDarakbangName').textContent = settings.darakbangName || '-';
        }

        // 거래 내역 테이블을 업데이트하는 함수
        function updateTransactionHistory() {
            const tbody = document.getElementById('transactionHistory');

            // 모든 거래 내역을 포함할 배열 생성
            let allTransactions = [];

            // 기존 거래 내역 추가
            allTransactions = allTransactions.concat(transactions);

            if (allTransactions.length === 0 && !settings.isSetup) { // 설정이 안되어있으면 이월잔고도 안보여줌
                // 거래 내역이 없으면 메시지 표시
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #666;">등록된 거래 내역이 없습니다.</td></tr>';
                return;
            }

            tbody.innerHTML = ''; // 기존 내용 지우기

            // 날짜와 시간 기준으로 정렬 (가장 최신 거래가 위로 오도록)
            allTransactions.sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime));

            // 정렬된 거래 내역을 순회하며 테이블에 추가
            allTransactions.forEach((transaction) => {
                const row = tbody.insertRow(); // 새로운 행 추가
                row.innerHTML = `
                    <td>${transaction.date}</td> <td>${transaction.type === 'income' ? '입금' : '출금'}</td>
                    <td>${transaction.category}</td>
                    <td>${transaction.description}</td>
                    <td>${transaction.personName}</td>
                    <td class="${transaction.type}">${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toLocaleString()}원</td>
                    <td>${transaction.balance.toLocaleString()}원</td>
                    <td><button onclick="deleteTransaction(${transaction.id})" style="background: #c8a48a; color: white; border: none; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">🗑️</button></td>
                `;
            });

            // 이월 잔고 항목 생성 및 가장 아래에 추가
            if (settings.isSetup) { // 설정이 완료된 경우에만 이월 잔고 항목 추가
                const carryOverRow = tbody.insertRow();
                carryOverRow.innerHTML = `
                    <td>${settings.baseDate || '-'}</td> <td>이월</td>
                    <td>-</td>
                    <td>이월 잔고</td>
                    <td>-</td>
                    <td>+${settings.carryOverBalance.toLocaleString()}원</td>
                    <td>${settings.carryOverBalance.toLocaleString()}원</td>
                    <td></td> `;
            }
        }

        // 회계 보고서를 생성하고 화면에 표시하는 함수
        function generateReport() {
            // 보고서 기간 설정 가져오기
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;

            // 기간에 맞는 거래 필터링
            let filteredTransactions = transactions;

            if (startDate && endDate) {
                filteredTransactions = transactions.filter(transaction => {
                    // dateTime 속성을 Date 객체로 변환하여 비교
                    const transactionDateTime = new Date(transaction.dateTime);
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    // 종료 날짜는 해당 날짜의 23:59:59까지 포함하도록 설정
                    end.setHours(23, 59, 59, 999);
                    return transactionDateTime >= start && transactionDateTime <= end;
                });
            } else if (startDate) {
                filteredTransactions = transactions.filter(transaction => {
                    const transactionDateTime = new Date(transaction.dateTime);
                    const start = new Date(startDate);
                    return transactionDateTime >= start;
                });
            } else if (endDate) {
                filteredTransactions = transactions.filter(transaction => {
                    const transactionDateTime = new Date(transaction.dateTime);
                    const end = new Date(endDate);
                    end.setHours(23, 59, 59, 999);
                    return transactionDateTime <= end;
                });
            } else {
                // 시작 날짜와 종료 날짜가 모두 비어있으면 전체 기간으로 설정
                filteredTransactions = [...transactions];
            }

            // 기간 시작 전까지의 잔액 계산
            let periodStartBalance = settings.carryOverBalance;
            if (startDate) {
                const beforeStartTransactions = transactions.filter(transaction => {
                    const transactionDateTime = new Date(transaction.dateTime);
                    const start = new Date(startDate);
                    return transactionDateTime < start;
                });
                beforeStartTransactions.forEach(transaction => {
                    if (transaction.type === 'income') {
                        periodStartBalance += transaction.amount;
                    } else {
                        periodStartBalance -= transaction.amount;
                    }
                });
            }

            // 필터링된 거래 내역의 총 수입 및 총 지출 계산
            const totalIncomeInPeriod = filteredTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpenseInPeriod = filteredTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);

            // 기간 종료 시점의 잔액 계산
            const periodEndBalance = periodStartBalance + totalIncomeInPeriod - totalExpenseInPeriod;

            // 카테고리별 수입 집계 초기화
            const incomeByCategory = {
                '이월 잔고': periodStartBalance, // 기간 시작 잔액을 이월 잔고로 표시
                '다락방 헌금': 0, '모임비': 0, '후원금': 0, '이자수입': 0, '기타수입': 0
            };

            // 카테고리별 지출 집계 초기화
            const expenseByCategory = {
                '다락방 헌금': 0, '식사비': 0, '열린 다락방 모임비': 0, '선물비': 0, '행사비': 0, '기타지출': 0
            };

            // 필터링된 거래 내역을 순회하며 카테고리별 금액 계산
            filteredTransactions.forEach(transaction => {
                if (transaction.type === 'income' && incomeByCategory.hasOwnProperty(transaction.category)) {
                    incomeByCategory[transaction.category] += transaction.amount;
                } else if (transaction.type === 'expense' && expenseByCategory.hasOwnProperty(transaction.category)) {
                    expenseByCategory[transaction.category] += transaction.amount;
                }
            });

            // 보고서 날짜 정보 업데이트
            document.getElementById('reportDate').textContent = new Date().toLocaleDateString('ko-KR');
            document.getElementById('reportDarakbangName').textContent = settings.darakbangName || '-'; // 다락방 이름 표시
            document.getElementById('reportManager').textContent = settings.managerName || '-';

            // 보고서 기간 텍스트 설정
            let periodText = '전체 기간';
            if (startDate && endDate) {
                periodText = `${startDate} ~ ${endDate}`;
            } else if (startDate) {
                periodText = `${startDate} 이후`;
            } else if (endDate) {
                periodText = `${endDate} 이전`;
            }
            document.getElementById('reportPeriod').textContent = periodText;

            // 통합 보고서 테이블 업데이트
            const consolidatedReportTbody = document.getElementById('consolidatedReport').querySelector('tbody');
            consolidatedReportTbody.innerHTML = '';

            // 수입 내역 추가
            consolidatedReportTbody.innerHTML += `
                <tr><td colspan="2" style="font-weight: bold; background-color: #f0f0f0;">💼 수입 내역 요약</td></tr>
            `;
            for (const category in incomeByCategory) {
                if (incomeByCategory.hasOwnProperty(category)) {
                    const row = consolidatedReportTbody.insertRow();
                    row.innerHTML = `<td>${category}</td><td class="income-amount">${incomeByCategory[category].toLocaleString()}원</td>`;
                }
            }
            consolidatedReportTbody.innerHTML += `
                <tr class="total-row"><td><strong>총 수입</strong></td><td class="amount income-amount"><strong>${(totalIncomeInPeriod + periodStartBalance).toLocaleString()}원</strong></td></tr>
            `;

            // 지출 내역 추가
            consolidatedReportTbody.innerHTML += `
                <tr><td colspan="2" style="font-weight: bold; background-color: #f0f0f0; padding-top: 20px;">💸 지출 내역 요약</td></tr>
            `;
            for (const category in expenseByCategory) {
                if (expenseByCategory.hasOwnProperty(category)) {
                    const row = consolidatedReportTbody.insertRow();
                    row.innerHTML = `<td>${category}</td><td class="expense-amount">${expenseByCategory[category].toLocaleString()}원</td>`;
                }
            }
            consolidatedReportTbody.innerHTML += `
                <tr class="total-row"><td><strong>총 지출</strong></td><td class="amount expense-amount"><strong>${totalExpenseInPeriod.toLocaleString()}원</strong></td></tr>
            `;

            // 최종 결산 추가
            consolidatedReportTbody.innerHTML += `
                <tr><td colspan="2" style="font-weight: bold; background-color: #f0f0f0; padding-top: 20px;">📈 최종 결산</td></tr>
                <tr><td>기간 시작 잔액</td><td class="balance-amount">${periodStartBalance.toLocaleString()}원</td></tr>
                <tr><td>총 수입</td><td class="income-amount">+${totalIncomeInPeriod.toLocaleString()}원</td></tr>
                <tr><td>총 지출</td><td class="expense-amount">-${totalExpenseInPeriod.toLocaleString()}원</td></tr>
                <tr class="total-row"><td><strong>기간 종료 잔액</strong></td><td class="amount balance-amount"><strong>${periodEndBalance.toLocaleString()}원</strong></td></tr>
            `;
        }

        // 보고서 인쇄 함수
        function printReport() {
            window.print();
        }

        // 커스텀 알림 메시지 표시 함수 (alert 대체)
        function showCustomAlert(message) {
            const alertBox = document.createElement('div');
            alertBox.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #f5f2f0;
                padding: 25px 35px;
                border-radius: 15px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
                z-index: 1000;
                text-align: center;
                font-size: 16px;
                color: #5a5a5a;
                border: 2px solid #d4b5a0;
                max-width: 80%;
                line-height: 1.5;
            `;
            alertBox.innerHTML = `
                <p>${message.replace(/\n/g, '<br>')}</p>
                <button onclick="this.parentNode.remove()" style="
                    margin-top: 20px;
                    padding: 10px 25px;
                    background: linear-gradient(135deg, #a8b59c 0%, #9ca892 100%);
                    color: white;
                    border: none;
                    border-radius: 20px;
                    cursor: pointer;
                    font-size: 15px;
                    font-weight: bold;
                    transition: all 0.3s ease;
                ">확인</button>
            `;
            document.body.appendChild(alertBox);
        }

        // 커스텀 확인 메시지 표시 함수 (confirm 대체)
        function showCustomConfirm(message, onConfirm) {
            const confirmBox = document.createElement('div');
            confirmBox.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #f5f2f0;
                padding: 25px 35px;
                border-radius: 15px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
                z-index: 1000;
                text-align: center;
                font-size: 16px;
                color: #5a5a5a;
                border: 2px solid #d4b5a0;
                max-width: 80%;
                line-height: 1.5;
            `;
            confirmBox.innerHTML = `
                <p>${message.replace(/\n/g, '<br>')}</p>
                <div style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
                    <button id="customConfirmYes" style="
                        padding: 10px 25px;
                        background: linear-gradient(135deg, #7d8471 0%, #6b7560 100%);
                        color: white;
                        border: none;
                        border-radius: 20px;
                        cursor: pointer;
                        font-size: 15px;
                        font-weight: bold;
                        transition: all 0.3s ease;
                    ">예</button>
                    <button id="customConfirmNo" style="
                        padding: 10px 25px;
                        background: linear-gradient(135deg, #c8a48a 0%, #b5936d 100%);
                        color: white;
                        border: none;
                        border-radius: 20px;
                        cursor: pointer;
                        font-size: 15px;
                        font-weight: bold;
                        transition: all 0.3s ease;
                    ">아니오</button>
                </div>
            `;
            document.body.appendChild(confirmBox);

            document.getElementById('customConfirmYes').onclick = () => {
                confirmBox.remove();
                onConfirm();
            };
            document.getElementById('customConfirmNo').onclick = () => {
                confirmBox.remove();
            };
        }
    </script>
</body>
</html>
                 